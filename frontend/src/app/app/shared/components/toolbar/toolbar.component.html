<mat-toolbar class="modern-toolbar">
  <div class="toolbar-container">
    <!-- Left: Brand -->
    <div class="brand-section" (click)="navigateToHome()" title="Go to Home">
      <div class="brand-icon">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/>
          <polyline points="22,6 12,13 2,6"/>
        </svg>
      </div>
      <span class="brand-name">MailChimp Figma</span>
    </div>

    <div class="toolbar-spacer"></div>

    <!-- Right: Navigation Arrows + User Menu -->
    <div class="right-section">
      <!-- Navigation Arrows -->
      <div class="nav-arrows">
        <button class="arrow-btn" (click)="goBack()" [disabled]="!canGoBack()" title="Previous">
          <mat-icon>arrow_back_ios</mat-icon>
        </button>
        <button class="arrow-btn" (click)="goForward()" [disabled]="!canGoForward()" title="Next">
          <mat-icon>arrow_forward_ios</mat-icon>
        </button>
      </div>

      <!-- User Menu -->
      <div class="user-section" *ngIf="currentUser$ | async as user">
        <button class="user-menu-btn" [matMenuTriggerFor]="userMenu" #menuTrigger="matMenuTrigger">
          <div class="user-avatar">
            <img *ngIf="user.picture" [src]="user.picture" [alt]="user.name" (error)="handleImageError($event, user.name)">
            <div *ngIf="!user.picture" class="avatar-initials">
              {{ getInitials(user.name) }}
            </div>
            <!-- Red Dot Notification for Pending Approvals -->
            <span class="notification-dot" *ngIf="isAdmin() && (pendingCount$ | async) as count" [attr.data-count]="count"></span>
          </div>
          <span class="user-name">{{ user.name }}</span>
          <mat-icon class="dropdown-icon" [class.open]="menuTrigger.menuOpen">expand_more</mat-icon>
        </button>

        <mat-menu #userMenu="matMenu" class="modern-user-dropdown" xPosition="before">
          <!-- Admin Button -->
          <button 
            *ngIf="isAdmin()" 
            mat-menu-item 
            class="menu-item admin-item"
            (click)="navigateToAdmin()">
            <div class="menu-item-icon admin-icon">
              <mat-icon>admin_panel_settings</mat-icon>
            </div>
            <div class="menu-item-content">
              <span class="menu-item-title">Admin Dashboard</span>
              <span class="menu-item-subtitle" *ngIf="(pendingCount$ | async) as count">
                {{ count }} pending approval{{ count !== 1 ? 's' : '' }}
              </span>
            </div>
            <span class="pending-badge" *ngIf="(pendingCount$ | async) as count">
              {{ count }}
            </span>
          </button>

          <mat-divider *ngIf="isAdmin()"></mat-divider>

            <!-- Generate Template Button ✅ NEW -->
          <button 
            mat-menu-item 
            class="menu-item generate-item"
            (click)="navigateTo('/generate')">
            <div class="menu-item-icon generate-icon">
              <mat-icon>auto_awesome</mat-icon>
            </div>
            <div class="menu-item-content">
              <span class="menu-item-title">Generate Template</span>
              <span class="menu-item-subtitle">Create with AI</span>
            </div>
          </button>

          <mat-divider></mat-divider>

          <!-- Visual Editor Button ✅ NEW -->
        <button 
          mat-menu-item 
          class="menu-item visual-editor-item"
          (click)="navigateTo('/visual-editor')">
          <div class="menu-item-icon visual-editor-icon">
            <mat-icon>design_services</mat-icon>
          </div>
          <div class="menu-item-content">
            <span class="menu-item-title">Visual Editor</span>
            <span class="menu-item-subtitle">Drag & drop designer</span>
          </div>
        </button>

        <mat-divider></mat-divider>

          <!-- Logout Button -->
          <button mat-menu-item class="menu-item logout-item" (click)="logout()">
            <div class="menu-item-icon logout-icon">
              <mat-icon>logout</mat-icon>
            </div>
            <div class="menu-item-content">
              <span class="menu-item-title">Logout</span>
            </div>
          </button>
        </mat-menu>
      </div>
    </div>
  </div>
</mat-toolbar>